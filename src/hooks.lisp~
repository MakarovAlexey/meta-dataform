(in-package :weblocks)

;;; View rendering utils
(defun find-view (view &optional (signal-error-p t))
  "Finds a view. If 'view' is a symbol, looks up the appropriate view
object. If 'view' is a view object, simply returns it. Otherwise,
signals an error.

If 'view' is a list, finds a scaffold class by calling
'scaffold-class-name' and builds an appropriate scaffold view by
calling 'generate-scaffold-view' with the scaffold class name and the
second argument."
  (if (typep view 'standard-dataform) view
      (or (etypecase view
	    (list (generate-scaffold-view (make-instance (scaffold-class-name (first view)))
					  (find-class (second view))))
	    (symbol (gethash view *views*))
	    (view view))
	  (when signal-error-p
	    (error "Cannot find view ~A" view)))))